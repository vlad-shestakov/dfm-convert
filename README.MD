# DFM file converter
*Приложение пакетно декодирует DFM-файлов в Юникод*

DFM-файлы - собственный стандарт кодирования Юникода для файлов проекта Delphi. Такой-же формат используется для хранения FRM-файлов метеданных проекта Diasoft Flextera. Инструментарий разработчика MetadataBuilder.

*DFM file converter* - приложение с GUI для Windows 10 и выше. 
* Декодирует содержимое DFM-файлов, где закодированный текст '*#1050#1072#1090#1077#1075#1086#1088#1080#1103*' декодируется в текст - '*Категория*'
* Обработка осуществляется пакетно для конкретной папки и файлов по маске расширения.
* Создаются резервные версии файлов с дополнительным расширением *.unic*

**Алгоритм обработки:**

* Выражение #nnnn - считается отдельным символом
* Кавычки между выражениями схлапываются (...#1050' '#1072...) в (...ка...)
* Также обрабатываются символы возврата каретки ('#13', '#10'), одинарные кавычки ('#39')
* Преобразования кодировок WINDOWS1251 -> UTF-8
* Файлы, где символа # не найдено не обрабатываются

Пример до:

      Caption = #1055#1086#1083#1103' '#1087#1086#1084#1077#1095#1077#1085#1085#1099#1077' '#13#10#1079#1074#1077#1079#1076#1086#1095#1082#1086#1081' '#1086#1073#1103#1079#1072#1090#1077#1083#1100#1085#1099' '#13#10#1076#1083#1103' '#1079#1072#1087#1086#1083#1085#1077#1085#1080#1103'.'


Пример после:

      Caption = 'Поля помеченные 
звездочкой обязательны 
для заполнения.'

**Известные ограничения:**
* Пути к файлам и файлы без кириллицы в названии
* Обрабатывает только один каталог, без рекурсии


***Технологический стек:***

Написано на Delphi 7, скомпилировано на Windows 11

**Как запустить**
* Скопировать файлы в программы *dfmconvert.exe*, *dfmconvert.ini* в папку с путем без кириллицы.
* Преобразования файлов делать только, если есть резервная копия данных.
* DFM файлы разместить в папке без кириллицы, например в *c:\test\dfm_data\*
* Запустить приложение *dfmconvert.exe*
* Вставить в поле DIR путь до папки - *c:\test\dfm_data*
* Убедиться, что в поле Ext. - выставлено нужное разрешение файлов. Например DFM или FRM (регистр не учитывается), можно использовать маску из трех символов.
* Нажать кнопку *Convert DFMs*
* В окне лога будет виден процесс обработки файлов. 
1) Первый этап выявление файлов, где есть символы юникода
2) Второй этам декодирование и создание резервной копии файла.


**Структура проекта:**
* /bin/dfmconvert.exe - программа
* /bin/dfmconvert.ini - настройки
* /bin/__backup-dfm.bat - Резервное копирование DFM и FRM файлов в подпапку /res
* /bin/__delete-dfm.bat - Удаление DFM и FRM файлов в папке
* /bin/__restore-dfm.bat - Восстановление DFM и FRM файлов из подпапки /res
* /src/* - исходный код */src*



***Тестирование:***
* Через сценарии Postman - *carparking.postman_collection.json*


**Параметры программы:**
Файл параметров - *dfmconvert.ini* (создается атоматически)

Пример структуры файла:

[MAIN]
ext=DFM
is_save_dir_path=0
dir_path=D:\R_STUDIO\PRG\DELPHI projects\2023-08-08 dfm-convert\test\test_data\

, где параметры:
* *ext* - маска файлов
* *is_save_dir_path* - сохранять ли в параметрах директорию, 1 - да / 0 - нет (по-умолчанию)
* *dir_path* - сохраненный


***Зависимости:***
* Delphi 7 for Windows 2000 (7.0 билд 4.453)
* Компоненты Delphi "KOL-MCK" (Владимир Кладов) - https://github.com/ebta/kol-mck 
  https://ru.wikipedia.org/wiki/KOL
  
Ядро реализации, delphikol. http://delphikol.narod.ru/

**TODO-LIST**

	[v] Не реализована кириллица в GUI и путях
	[v] Обработка ошибок, отмечены  как //todo
	[v] Только GUI версия
